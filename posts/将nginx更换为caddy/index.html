<!doctype html><html lang=zh-CN dir=ltr class=scroll-smooth data-default-appearance=light data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="zh-cn"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>将Nginx更换为Caddy &#183; 容器</title><meta name=title content="将Nginx更换为Caddy &#183; 容器"><meta name=keywords content="SSL,Nginx,Caddy,Debian,"><link rel=canonical href=https://b.myvessel.top/posts/%E5%B0%86nginx%E6%9B%B4%E6%8D%A2%E4%B8%BAcaddy/><link type=text/css rel=stylesheet href=/css/main.bundle.min.14ca0fd95a3c15c960e83b49e9cb79f552ed206508f069f44b5401064bec1d9e1828e9e497c282d39b13a7a759a9bf9766a14689723deab3d2f8fe8cea393bd4.css integrity="sha512-FMoP2Vo8Fclg6DtJ6ct59VLtIGUI8Gn0S1QBBkvsHZ4YKOnkl8KC05sTp6dZqb+XZqFGiXI96rPS+P6M6jk71A=="><script type=text/javascript src=/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script>
<script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.3ddcf04f5b0d4c32f72e726d3c12eebccd8c3c9f9daa9a13414808895de0ae1e1cdddda6849680d5bd96dbb60d0b1e0b24c29f5c83e5631e55e7e6bc02015490.js integrity="sha512-PdzwT1sNTDL3LnJtPBLuvM2MPJ+dqpoTQUgIiV3grh4c3d2mhJaA1b2W27YNCx4LJMKfXIPlYx5V5+a8AgFUkA==" data-copy data-copied></script>
<script src=/js/zoom.min.js></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="将Nginx更换为Caddy"><meta property="og:description" content><meta property="og:type" content="article"><meta property="og:url" content="https://b.myvessel.top/posts/%E5%B0%86nginx%E6%9B%B4%E6%8D%A2%E4%B8%BAcaddy/"><meta property="og:image" content="https://b.myvessel.top/posts/%E5%B0%86nginx%E6%9B%B4%E6%8D%A2%E4%B8%BAcaddy/feature.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-04-04T16:20:55+08:00"><meta property="article:modified_time" content="2023-04-04T16:20:55+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://b.myvessel.top/posts/%E5%B0%86nginx%E6%9B%B4%E6%8D%A2%E4%B8%BAcaddy/feature.jpg"><meta name=twitter:title content="将Nginx更换为Caddy"><meta name=twitter:description content><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"将Nginx更换为Caddy","headline":"将Nginx更换为Caddy","inLanguage":"zh-cn","url":"https:\/\/b.myvessel.top\/posts\/%E5%B0%86nginx%E6%9B%B4%E6%8D%A2%E4%B8%BAcaddy\/","author":{"@type":"Person","name":"Vessel"},"copyrightYear":"2023","dateCreated":"2023-04-04T16:20:55\u002b08:00","datePublished":"2023-04-04T16:20:55\u002b08:00","dateModified":"2023-04-04T16:20:55\u002b08:00","keywords":["SSL","Nginx","Caddy","Debian"],"mainEntityOfPage":"true","wordCount":"4235"}]</script><meta name=author content="Vessel"><link href=mailto:w1572651092@gmail.com rel=me><link href=https://github.com/0Vessel0 rel=me><link href=https://acg.mn/@w1572651092 rel=me><link href=https://t.me/vesselvessel rel=me><script src=/lib/jquery/jquery.slim.min.js integrity></script><meta name=theme-color><script src=https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js></script>
<script src=https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js></script>
<script src=https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js></script>
<script>const firebaseConfig={apiKey:"AIzaSyBhCLxCAZAsZyOY5Jfx3GQpXY8-WKsgMAY",authDomain:"AIzaSyBhCLxCAZAsZyOY5Jfx3GQpXY8-WKsgMAY",projectId:"hugo-vessel",storageBucket:"hugo-vessel.appspot.com",messagingSenderId:"296824508371",appId:"1:296824508371:web:215570749ab6d460832926",measurementId:"G-8MFDNYY6J5"};var app=firebase.initializeApp(firebaseConfig),db=firebase.firestore(),auth=firebase.auth()</script></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span></a></div><div class=min-h-[148px]></div><div class="fixed inset-x-0 pl-[24px] pr-[24px]" style=z-index:100><div id=menu-blur class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl"></div><div class="relative max-w-[64rem] ml-auto mr-auto"><div style=padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900">容器</a></nav><nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12"><a href=/posts/ class="flex items-center"><span class=mr-1><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 32H480c17.7.0 32 14.3 32 32V96c0 17.7-14.3 32-32 32H32C14.3 128 0 113.7.0 96V64C0 46.3 14.3 32 32 32zm0 128H480V416c0 35.3-28.7 64-64 64H96c-35.3.0-64-28.7-64-64V160zm128 80c0 8.8 7.2 16 16 16H336c8.8.0 16-7.2 16-16s-7.2-16-16-16H176c-8.8.0-16 7.2-16 16z"/></svg></span></span><p class="text-base font-medium text-gray-500 hover:text-gray-900" title=Posts>归档</p></a><div><div class="cursor-pointer flex items-center nested-menu"><span class=mr-1><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M0 80C0 53.5 21.5 32 48 32h96c26.5.0 48 21.5 48 48V96H384V80c0-26.5 21.5-48 48-48h96c26.5.0 48 21.5 48 48v96c0 26.5-21.5 48-48 48H432c-26.5.0-48-21.5-48-48V160H192v16c0 1.7-.1 3.4-.3 5L272 288h96c26.5.0 48 21.5 48 48v96c0 26.5-21.5 48-48 48H272c-26.5.0-48-21.5-48-48V336c0-1.7.1-3.4.3-5L144 224H48c-26.5.0-48-21.5-48-48V80z"/></svg></span></span><a class="text-base font-medium text-gray-500 hover:text-gray-900" title>清单</a>
<span><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75.0 011.06.02L10 11.168l3.71-3.938a.75.75.0 111.08 1.04l-4.25 4.5a.75.75.0 01-1.08.0l-4.25-4.5a.75.75.0 01.02-1.06z" clip-rule="evenodd"/></svg></span></span></div><div class="absolute menuhide"><div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl"><div class="flex flex-col space-y-3"><a href=/categories/ class="flex items-center"><span class=mr-1><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M0 96C0 78.3 14.3 64 32 64H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7.0 96zM64 256c0-17.7 14.3-32 32-32H480c17.7.0 32 14.3 32 32s-14.3 32-32 32H96c-17.7.0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7.0-32-14.3-32-32s14.3-32 32-32H416c17.7.0 32 14.3 32 32z"/></svg></span></span><p class="text-sm font-sm text-gray-500 hover:text-gray-900" title=Categories>分类</p></a><a href=/tags/ class="flex items-center"><span class=mr-1><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M345 39.1 472.8 168.4c52.4 53 52.4 138.2.0 191.2l-112 113.3c-9.3 9.4-24.5 9.5-33.9.2s-9.5-24.5-.2-33.9L438.6 325.9c33.9-34.3 33.9-89.4.0-123.7L310.9 72.9c-9.3-9.4-9.2-24.6.2-33.9s24.6-9.2 33.9.2zM0 229.5V80C0 53.5 21.5 32 48 32H197.5c17 0 33.3 6.7 45.3 18.7l168 168c25 25 25 65.5.0 90.5L277.3 442.7c-25 25-65.5 25-90.5.0l-168-168C6.7 262.7.0 246.5.0 229.5zM144 144a32 32 0 10-64 0 32 32 0 1064 0z"/></svg></span></span><p class="text-sm font-sm text-gray-500 hover:text-gray-900" title=Tags>标签</p></a></div></div></div></div><a href=/links/ class="flex items-center"><span class=mr-1><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M47.6 300.4 228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6.0 115.2.0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"/></svg></span></span><p class="text-base font-medium text-gray-500 hover:text-gray-900" title=友链>友链</p></a><a href=/journal/ class="flex items-center"><span class=mr-1><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M408 120c0 54.6-73.1 151.9-105.2 192-7.7 9.6-22 9.6-29.6.0C241.1 271.9 168 174.6 168 120 168 53.7 221.7.0 288 0s120 53.7 120 120zm8 80.4c3.5-6.9 6.7-13.8 9.6-20.6.5-1.2 1-2.5 1.5-3.7l116-46.4C558.9 123.4 576 135 576 152V422.8c0 9.8-6 18.6-15.1 22.3L416 503V200.4zM137.6 138.3c2.4 14.1 7.2 28.3 12.8 41.5 2.9 6.8 6.1 13.7 9.6 20.6V451.8L32.9 502.7C17.1 509 0 497.4.0 480.4V209.6c0-9.8 6-18.6 15.1-22.3l122.6-49zM327.8 332c13.9-17.4 35.7-45.7 56.2-77V504.3L192 449.4V255c20.5 31.3 42.3 59.6 56.2 77 20.5 25.6 59.1 25.6 79.6.0zM288 152a40 40 0 100-80 40 40 0 100 80z"/></svg></span></span><p class="text-base font-medium text-gray-500 hover:text-gray-900" title=日志>日志</p></a><a href=/about/ class="flex items-center"><span class=mr-1><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M159.3 5.4c7.8-7.3 19.9-7.2 27.7.1 27.6 25.9 53.5 53.8 77.7 84 11-14.4 23.5-30.1 37-42.9 7.9-7.4 20.1-7.4 28 .1 34.6 33 63.9 76.6 84.5 118 20.3 40.8 33.8 82.5 33.8 111.9C448 404.2 348.2 512 224 512 98.4 512 0 404.1.0 276.5c0-38.4 17.8-85.3 45.4-131.7C73.3 97.7 112.7 48.6 159.3 5.4zM225.7 416c25.3.0 47.7-7 68.8-21 42.1-29.4 53.4-88.2 28.1-134.4-2.8-5.6-5.6-11.2-9.8-16.8l-50.6 58.8S180.8 199 175.1 192c-42 51.8-63.1 81.2-63.1 114.8C112 375.4 162.6 416 225.7 416z"/></svg></span></span><p class="text-base font-medium text-gray-500 hover:text-gray-900" title=关于>关于</p></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400 h-12" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="ltr:mr-14 rtl:ml-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"><button id=appearance-switcher aria-label="Dark mode switcher" type=button><div class="flex items-center justify-center h-12 dark:hidden"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden h-12 dark:flex"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center space-x-5 md:ml-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button style=margin-right:5px><div class="flex items-center justify-center h-12 dark:hidden"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden h-12 dark:flex"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 -mr-2 md:hidden"><label id=menu-button for=menu-controller class=block><input type=checkbox id=menu-controller class=hidden><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper style=padding-top:5px class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/posts/ class="flex items-center"><div class=mr-2><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 32H480c17.7.0 32 14.3 32 32V96c0 17.7-14.3 32-32 32H32C14.3 128 0 113.7.0 96V64C0 46.3 14.3 32 32 32zm0 128H480V416c0 35.3-28.7 64-64 64H96c-35.3.0-64-28.7-64-64V160zm128 80c0 8.8 7.2 16 16 16H336c8.8.0 16-7.2 16-16s-7.2-16-16-16H176c-8.8.0-16 7.2-16 16z"/></svg></span></div><p class="text-bg font-bg text-gray-500 hover:text-gray-900" title=Posts>归档</p></a></li><li class=mt-1><a class="flex items-center"><span class=mr-1><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M0 80C0 53.5 21.5 32 48 32h96c26.5.0 48 21.5 48 48V96H384V80c0-26.5 21.5-48 48-48h96c26.5.0 48 21.5 48 48v96c0 26.5-21.5 48-48 48H432c-26.5.0-48-21.5-48-48V160H192v16c0 1.7-.1 3.4-.3 5L272 288h96c26.5.0 48 21.5 48 48v96c0 26.5-21.5 48-48 48H272c-26.5.0-48-21.5-48-48V336c0-1.7.1-3.4.3-5L144 224H48c-26.5.0-48-21.5-48-48V80z"/></svg></span></span><p class="text-bg font-bg text-gray-500 hover:text-gray-900" title>清单</p><span><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75.0 011.06.02L10 11.168l3.71-3.938a.75.75.0 111.08 1.04l-4.25 4.5a.75.75.0 01-1.08.0l-4.25-4.5a.75.75.0 01.02-1.06z" clip-rule="evenodd"/></svg></span></span></a></li><li class=mt-1><a href=/categories/ class="flex items-center"><span class=mr-1><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M0 96C0 78.3 14.3 64 32 64H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7.0 96zM64 256c0-17.7 14.3-32 32-32H480c17.7.0 32 14.3 32 32s-14.3 32-32 32H96c-17.7.0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7.0-32-14.3-32-32s14.3-32 32-32H416c17.7.0 32 14.3 32 32z"/></svg></span></span><p class="text-sm font-small text-gray-500 hover:text-gray-900" title=Categories>分类</p></a></li><li class=mt-1><a href=/tags/ class="flex items-center"><span class=mr-1><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M345 39.1 472.8 168.4c52.4 53 52.4 138.2.0 191.2l-112 113.3c-9.3 9.4-24.5 9.5-33.9.2s-9.5-24.5-.2-33.9L438.6 325.9c33.9-34.3 33.9-89.4.0-123.7L310.9 72.9c-9.3-9.4-9.2-24.6.2-33.9s24.6-9.2 33.9.2zM0 229.5V80C0 53.5 21.5 32 48 32H197.5c17 0 33.3 6.7 45.3 18.7l168 168c25 25 25 65.5.0 90.5L277.3 442.7c-25 25-65.5 25-90.5.0l-168-168C6.7 262.7.0 246.5.0 229.5zM144 144a32 32 0 10-64 0 32 32 0 1064 0z"/></svg></span></span><p class="text-sm font-small text-gray-500 hover:text-gray-900" title=Tags>标签</p></a></li><li class=mb-2></li><li class=mt-1><a href=/links/ class="flex items-center"><div class=mr-2><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M47.6 300.4 228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6.0 115.2.0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"/></svg></span></div><p class="text-bg font-bg text-gray-500 hover:text-gray-900" title=友链>友链</p></a></li><li class=mt-1><a href=/journal/ class="flex items-center"><div class=mr-2><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M408 120c0 54.6-73.1 151.9-105.2 192-7.7 9.6-22 9.6-29.6.0C241.1 271.9 168 174.6 168 120 168 53.7 221.7.0 288 0s120 53.7 120 120zm8 80.4c3.5-6.9 6.7-13.8 9.6-20.6.5-1.2 1-2.5 1.5-3.7l116-46.4C558.9 123.4 576 135 576 152V422.8c0 9.8-6 18.6-15.1 22.3L416 503V200.4zM137.6 138.3c2.4 14.1 7.2 28.3 12.8 41.5 2.9 6.8 6.1 13.7 9.6 20.6V451.8L32.9 502.7C17.1 509 0 497.4.0 480.4V209.6c0-9.8 6-18.6 15.1-22.3l122.6-49zM327.8 332c13.9-17.4 35.7-45.7 56.2-77V504.3L192 449.4V255c20.5 31.3 42.3 59.6 56.2 77 20.5 25.6 59.1 25.6 79.6.0zM288 152a40 40 0 100-80 40 40 0 100 80z"/></svg></span></div><p class="text-bg font-bg text-gray-500 hover:text-gray-900" title=日志>日志</p></a></li><li class=mt-1><a href=/about/ class="flex items-center"><div class=mr-2><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M159.3 5.4c7.8-7.3 19.9-7.2 27.7.1 27.6 25.9 53.5 53.8 77.7 84 11-14.4 23.5-30.1 37-42.9 7.9-7.4 20.1-7.4 28 .1 34.6 33 63.9 76.6 84.5 118 20.3 40.8 33.8 82.5 33.8 111.9C448 404.2 348.2 512 224 512 98.4 512 0 404.1.0 276.5c0-38.4 17.8-85.3 45.4-131.7C73.3 97.7 112.7 48.6 159.3 5.4zM225.7 416c25.3.0 47.7-7 68.8-21 42.1-29.4 53.4-88.2 28.1-134.4-2.8-5.6-5.6-11.2-9.8-16.8l-50.6 58.8S180.8 199 175.1 192c-42 51.8-63.1 81.2-63.1 114.8C112 375.4 162.6 416 225.7 416z"/></svg></span></div><p class="text-bg font-bg text-gray-500 hover:text-gray-900" title=关于>关于</p></a></li></ul></div></label></div></div><script>(function(){var e=$(".main-menu"),t=window.location.pathname;e.find('a[href="'+t+'"]').each(function(e,t){$(t).children("p").addClass("active")})})()</script></div></div><script>window.addEventListener("scroll",function(){var t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,n=document.getElementById("menu-blur");n.style.opacity=t/300})</script><div class="relative flex flex-col grow"><main id=main-content class=grow><article><div id=hero class="h-[150px] md:h-[200px]"></div><div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom" style="background-image:url(https://lp.ena.sh/r?uid=vessel&albumid=9&ttl=%5b61%5d)"><div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal"></div><div class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal"></div></div><div id=background-blur class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div><script>window.addEventListener("scroll",function(){var t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,n=document.getElementById("background-blur");n.style.opacity=t/300})</script><header id=single_header class="mt-5 max-w-prose"><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">将Nginx更换为Caddy</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2023-04-04 16:20:55 +0800 +0800">2023年 4月 4日</time><span class="px-2 text-primary-500">&#183;</span><span>4235 字</span><span class="px-2 text-primary-500">&#183;</span><span title=预计阅读>9 分钟</span><span class="px-2 text-primary-500">&#183;</span><span>
<span id=views_posts/将Nginx更换为Caddy/index.md title=views>0</span>
<span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M288 32c-80.8.0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7.0 24.6C17.3 304 48.6 356 95.4 399.4 142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1 3.3-7.9 3.3-16.7.0-24.6-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144 64.5-144 144-144 144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64-11.5.0-22.3-3-31.6-8.4-.2 2.8-.4 5.5-.4 8.4.0 53 43 96 96 96s96-43 96-96-43-96-96-96c-2.8.0-5.6.1-8.4.4 5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></span></span><span class="px-2 text-primary-500">&#183;</span><span>
<span id=likes_posts/将Nginx更换为Caddy/index.md title=likes>0</span>
<span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M47.6 300.4 228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6.0 115.2.0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"/></svg></span></span></span><span class="px-2 text-primary-500">&#183;</span><span>
<button id=likes_button class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400" onclick=process_article()>
<span id=likes_button_heart style=display:none class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M47.6 300.4 228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6.0 115.2.0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"/></svg></span></span><span id=likes_button_emtpty_heart class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M244 84l11.1 12 12-11.98C300.6 51.37 347 36.51 392.6 44.1 461.5 55.58 512 115.2 512 185.1V190.9c0 41.5-17.2 81.2-47.6 109.5L283.7 469.1c-7.5 7-17.4 10.9-27.7 10.9S235.8 476.1 228.3 469.1L47.59 300.4C17.23 272.1.0 232.4.0 190.9V185.1c0-69.9 50.52-129.52 119.4-141 44.7-7.59 92 7.27 124.6 39.9C243.1 84 244 84.01 244 84zm11.1 79.9-45-46.8c-21.7-20.82-52.5-30.7-82.8-25.66C81.55 99.07 48 138.7 48 185.1V190.9c0 28.2 11.71 55.2 32.34 74.4L256 429.3l175.7-164c20.6-19.2 32.3-46.2 32.3-74.4V185.1c0-46.4-33.6-86.03-79.3-93.66C354.4 86.4 323.6 96.28 301.9 117.1l-46.8 46.8z"/></svg></span></span><span id=likes_button_text>&nbsp;Like</span></button></span></div><div class="flex flex-row flex-wrap items-center"></div><div class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='window.open("/categories/%E5%AE%9E%E7%94%A8%E7%9A%84%E4%B8%9C%E8%A5%BF/","_self")'><span class=flex><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">实用的东西</span></span></span>
<span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/ssl/","_self")'><span class=flex><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">SSL</span></span></span>
<span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/nginx/","_self")'><span class=flex><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Nginx</span></span></span>
<span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/caddy/","_self")'><span class=flex><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Caddy</span></span></span>
<span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/debian/","_self")'><span class=flex><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Debian</span></span></span></div></div><div class=flex><img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width=96 height=96 alt=Vessel src=/img/logo_huc30493f834270db7695c249eed3e0602_388971_192x192_fill_box_center_3.png><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">作者</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Vessel</div><div class="text-sm text-neutral-700 dark:text-neutral-400">这是没有办法的事，为了追求进一步的幸福，痛苦是必要的</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=mailto:w1572651092@gmail.com target=_blank aria-label=Email rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/0Vessel0 target=_blank aria-label=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://acg.mn/@w1572651092 target=_blank aria-label=Mastodon rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48.0.0.0-63.72 28.5-63.72 125.7.0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54.0 01-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg></span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://t.me/vesselvessel target=_blank aria-label=Telegram rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M248 8C111.033 8 0 119.033.0 256S111.033 504 248 504 496 392.967 496 256 384.967 8 248 8zM362.952 176.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452.0 013.53 6.716A43.765 43.765.0 01362.952 176.66z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first sm:max-w-prose lg:ml-auto px-0 lg:order-last lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-[140px]"><details open class="mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden"></summary><div class="min-w-[220px] py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#前言>前言</a></li><li><a href=#nginx-vs-caddy>Nginx VS Caddy</a></li><li><a href=#caddy-的安装>Caddy 的安装</a><ul><li><a href=#go-的安装>Go 的安装</a></li><li><a href=#xcaddy-的安装>Xcaddy 的安装</a><ul><li><a href=#apt-安装>Apt 安装</a></li><li><a href=#编译安装>编译安装</a></li><li><a href=#go-安装>Go 安装</a></li></ul></li></ul></li><li><a href=#安装-caddy>安装 Caddy</a></li><li><a href=#caddyfile>Caddyfile</a><ul><li><a href=#简单上手-caddyfile>简单上手 Caddyfile</a></li><li><a href=#测试格式化-caddyfile>测试，格式化 Caddyfile</a></li></ul></li><li><a href=#启动-caddy>启动 Caddy</a></li><li><a href=#保护-caddy-进程>保护 Caddy 进程</a></li><li><a href=#后记>后记</a></li><li><a href=#参考文章>参考文章</a></li></ul></nav></div></details><details class="mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden"></summary><div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#前言>前言</a></li><li><a href=#nginx-vs-caddy>Nginx VS Caddy</a></li><li><a href=#caddy-的安装>Caddy 的安装</a><ul><li><a href=#go-的安装>Go 的安装</a></li><li><a href=#xcaddy-的安装>Xcaddy 的安装</a><ul><li><a href=#apt-安装>Apt 安装</a></li><li><a href=#编译安装>编译安装</a></li><li><a href=#go-安装>Go 安装</a></li></ul></li></ul></li><li><a href=#安装-caddy>安装 Caddy</a></li><li><a href=#caddyfile>Caddyfile</a><ul><li><a href=#简单上手-caddyfile>简单上手 Caddyfile</a></li><li><a href=#测试格式化-caddyfile>测试，格式化 Caddyfile</a></li></ul></li><li><a href=#启动-caddy>启动 Caddy</a></li><li><a href=#保护-caddy-进程>保护 Caddy 进程</a></li><li><a href=#后记>后记</a></li><li><a href=#参考文章>参考文章</a></li></ul></nav></div></details><script>(function(){var t,e=$("#TableOfContents");if(e.length>0){t=$(window);function n(){var s,o=t.scrollTop(),i=$(".anchor"),n="";if(i.each(function(e,t){t=$(t),t.offset().top-$(window).height()/3<=o&&(n=t.attr("id"))}),s=e.find("a.active"),s.length==1&&s.eq(0).attr("href")=="#"+n)return!0;s.each(function(e,t){$(t).removeClass("active").siblings("ul").hide()}),e.find('a[href="#'+n+'"]').addClass("active"),e.find('a[href="#'+n+'"]').parentsUntil("#TableOfContents").each(function(e,t){$(t).children("a").parents("ul").show()})}t.on("scroll",n),$(document).ready(function(){e.find("a").parent("li").find("ul").hide(),n()})}})()</script></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="max-w-prose mb-20"><div id=前言 class=anchor></div><h2 class="relative group">前言
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%89%8d%e8%a8%80 aria-label=锚点>#</a></span></h2><p>在搭建博客期间，我在两个地方踩的坑最多，花的时间也最多。其一是 SSL 证书，其二是 Nginx。其实在了解之后配置 Nginx 和获取 SSL 证书也不算特别麻烦，但对以前没接触过的新手来说无疑是非常头疼的 (当然也有可能是 Apache)。但昨天 <a href=https://naine.cc target=_blank>naine</a> 跟我提到了 Caddy，听说可以直接解决这两大问题，所以今天不是来倒这俩玩意的苦水，而是来试水 Caddy。</p><p>顺带一提在写这篇文章的时候，本站已经是使用 Caddy 进行工作了。</p><div class="flex px-4 py-3 rounded-md" style=background-color:#e63946><span class="ltr:pr-3 rtl:pl-3 flex items-center" style=color:#1d3557><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M506.3 417 293 53c-16.33-28-57.54-28-73.98.0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6c32.76.0 53.26-35 36.96-63zM232 168c0-13.25 10.75-24 24-24s24 10.8 24 24v128c0 13.25-10.75 24-23.1 24S232 309.3 232 296V168zm24 248c-17.36.0-31.44-14.08-31.44-31.44s14.07-31.44 31.44-31.44 31.44 14.08 31.44 31.44C287.4 401.9 273.4 416 256 416z"/></svg></span></span><span style=color:#f1faee>本文所有命令如无特别说明，请以 root 用户身份运行。</span></div><div id=nginx-vs-caddy class=anchor></div><h2 class="relative group">Nginx VS Caddy
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#nginx-vs-caddy aria-label=锚点>#</a></span></h2><p>Nginx 作为老牌选手，自然拥有很多优点。</p><ul><li>处理并发能力极强，可同时支持 2~4 万个连接。</li><li>低内存消耗，3 万并发连接，10 个 Nginx 进程的情况下，消耗内存不到 150 MB。</li><li>稳定性强，可连续运行数个月不需要重启，还支持热更新。</li><li>作为老牌软件一般很多系统官方源都有收录对应的包，安装较为简单 (最新版不一定简单)。</li></ul><p>而 Caddy 的优点如下：</p><ul><li>Golang 写的，几乎无依赖，非常干净，一个二进制文件搞定。</li><li>无需配置，默认全站 https，自动申请证书，自动到期续签。</li><li>无需配置，默认全站 http2 (可以配置 http3)。</li><li>配置文件相比于 Nginx 非常简单，容易上手，一目了然。</li></ul><p>综上，作为一个私人博客其实没有那么高的访问量和负载问题，nginx 除了稳定之外的大部分优点其实是用不到的，但是缺点较为明显，就是要自己去申请 SSL 证书，自己进行繁琐的配置。这对于一个新手来说是比较麻烦，要付出大量时间成本去试错的问题。而反过来 Caddy 的配置文件很简单，并且自动申请证书续签证书，对新手来说非常友好。看到这里我已经比较心动了，所以废话不多说，直接开工。</p><div id=caddy-的安装 class=anchor></div><h2 class="relative group">Caddy 的安装
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#caddy-%e7%9a%84%e5%ae%89%e8%a3%85 aria-label=锚点>#</a></span></h2><div id=go-的安装 class=anchor></div><h3 class="relative group">Go 的安装
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#go-%e7%9a%84%e5%ae%89%e8%a3%85 aria-label=锚点>#</a></span></h3><p>由于 Caddy 是 Golang 写的，我的系统不自带，所以需要先安装 Go。</p><p>先安装一些必要的软件包。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>apt update
</span></span><span class=line><span class=cl>apt upgrade -y
</span></span><span class=line><span class=cl>apt install curl vim wget gnupg dpkg apt-transport-https lsb-release ca-certificates
</span></span></code></pre></div><p>然后根据<a href=https://go.dev/doc/install target=_blank>
官方教程</a>进行安装。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>wget https://go.dev/dl/go1.20.2.linux-amd64.tar.gz <span class=c1># 版本号可自选</span>
</span></span><span class=line><span class=cl>rm -rf /usr/local/go <span class=o>&amp;&amp;</span> tar -C /usr/local -xzf go1.20.2.linux-amd64.tar.gz
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=nb>export</span> <span class=nv>PATH</span><span class=o>=</span><span class=nv>$PATH</span>:/usr/local/go/bin <span class=p>|</span> sudo tee -a /etc/profile <span class=c1># 这里与官方教程不一样，使用此命令可让此环境变量为所有用户生效</span>
</span></span><span class=line><span class=cl><span class=nb>source</span> /etc/profile
</span></span><span class=line><span class=cl>go version <span class=c1># 验证安装成功与否</span>
</span></span></code></pre></div><div id=xcaddy-的安装 class=anchor></div><h3 class="relative group">Xcaddy 的安装
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#xcaddy-%e7%9a%84%e5%ae%89%e8%a3%85 aria-label=锚点>#</a></span></h3><div id=apt-安装 class=anchor></div><h4 class="relative group">Apt 安装
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#apt-%e5%ae%89%e8%a3%85 aria-label=锚点>#</a></span></h4><p>直接 <code>apt install</code> 安装的 caddy 不能自定义插件，可以使用官方的 xcaddy 自己编译加入了自己喜欢的插件的 caddy 二进制文件。</p><p>首先加入 caddy 的公钥和源</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -sSL https://dl.cloudsmith.io/public/caddy/xcaddy/gpg.key <span class=p>|</span> gpg --dearmor &gt; /usr/share/keyrings/xcaddy.gpg
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;deb [arch=</span><span class=k>$(</span>dpkg --print-architecture<span class=k>)</span><span class=s2> signed-by=/usr/share/keyrings/xcaddy.gpg] https://dl.cloudsmith.io/public/caddy/xcaddy/deb/debian any-version main&#34;</span> &gt; /etc/apt/sources.list.d/xcaddy.list
</span></span></code></pre></div><p>然后</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>apt update
</span></span><span class=line><span class=cl>apt install xcaddy
</span></span><span class=line><span class=cl>xcaddy version
</span></span></code></pre></div><p>即可完成安装。</p><div id=编译安装 class=anchor></div><h4 class="relative group">编译安装
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e7%bc%96%e8%af%91%e5%ae%89%e8%a3%85 aria-label=锚点>#</a></span></h4><p>若是不喜欢 <code>apt</code> 安装，可以在
<a target=_blank href=https://github.com/caddyserver/xcaddy class=cursor-pointer><div class="w-full md:w-auto pt-3 p-5 border border-neutral-200 dark:border-neutral-700 border rounded-md backdrop-blur shadow-2xl"><div class="flex items-center"><span class="text-2xl text-neutral-800 dark:text-neutral" style=margin-right:10px><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span><div class="m-0 font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral">caddyserver/xcaddy</div></div><p class="m-0 mt-2 text-md text-neutral-800 dark:text-neutral">Build Caddy with plugins</p><div class="m-0 mt-2 flex items-center"><span class="mr-1 inline-block h-3 w-3 rounded-full" style=background-color:#00add8></span><div class="m-0 mr-5 text-md text-neutral-800 dark:text-neutral">Go</div><span class="text-md mr-1 text-neutral-800 dark:text-neutral"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M287.9.0C297.1.0 305.5 5.25 309.5 13.52L378.1 154.8l153.3 22.7C540.4 178.8 547.8 185.1 550.7 193.7 553.5 202.4 551.2 211.9 544.8 218.2L433.6 328.4l26.3 155.5C461.4 492.9 457.7 502.1 450.2 507.4 442.8 512.7 432.1 513.4 424.9 509.1L287.9 435.9 150.1 509.1C142.9 513.4 133.1 512.7 125.6 507.4 118.2 502.1 114.5 492.9 115.1 483.9l27.1-155.5L31.11 218.2C24.65 211.9 22.36 202.4 25.2 193.7 28.03 185.1 35.5 178.8 44.49 177.5L197.7 154.8 266.3 13.52C270.4 5.249 278.7.0 287.9.0zm0 78.95L235.4 187.2C231.9 194.3 225.1 199.3 217.3 200.5L98.98 217.9 184.9 303C190.4 308.5 192.9 316.4 191.6 324.1L171.4 443.7l105.2-56.2C283.7 383.7 292.2 383.7 299.2 387.5l105.2 56.2-20.2-119.6C382.9 316.4 385.5 308.5 391 303l85.9-85.1-118.3-17.4C350.7 199.3 343.9 194.3 340.5 187.2L287.9 78.95z"/></svg></span></span><div class="m-0 mr-5 text-md text-neutral-800 dark:text-neutral">645</div><span class="text-md mr-1 text-neutral-800 dark:text-neutral"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M80 104c13.3.0 24-10.7 24-24S93.3 56 80 56 56 66.7 56 80s10.7 24 24 24zm80-24c0 32.8-19.7 61-48 73.3V192c0 17.7 14.3 32 32 32H304c17.7.0 32-14.3 32-32V153.3C307.7 141 288 112.8 288 80c0-44.2 35.8-80 80-80s80 35.8 80 80c0 32.8-19.7 61-48 73.3V192c0 53-43 96-96 96H256v70.7c28.3 12.3 48 40.5 48 73.3.0 44.2-35.8 80-80 80s-80-35.8-80-80c0-32.8 19.7-61 48-73.3V288H144c-53 0-96-43-96-96V153.3C19.7 141 0 112.8.0 80 0 35.8 35.8.0 80 0s80 35.8 80 80zm208 24c13.3.0 24-10.7 24-24s-10.7-24-24-24-24 10.7-24 24 10.7 24 24 24zM248 432c0-13.3-10.7-24-24-24s-24 10.7-24 24 10.7 24 24 24 24-10.7 24-24z"/></svg></span></span><div class="m-0 mr-5 text-md text-neutral-800 dark:text-neutral">100</div></div></div></a>的releases中下载对应的包，自行编译安装。</p><div id=go-安装 class=anchor></div><h4 class="relative group">Go 安装
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#go-%e5%ae%89%e8%a3%85 aria-label=锚点>#</a></span></h4><p>也可以使用上一步安装好的 Go 来安装 xcaddy。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>go install github.com/caddyserver/xcaddy/cmd/xcaddy@latest
</span></span></code></pre></div><p>不过我自己没试过，不知道具体效果如何有兴趣可自行尝试。</p><p>准备工作稍显麻烦，这也是 Caddy 对新手来说不太友好的地方。好在这是一劳永逸的，可以接受。</p><div id=安装-caddy class=anchor></div><h2 class="relative group">安装 Caddy
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%ae%89%e8%a3%85-caddy aria-label=锚点>#</a></span></h2><p>完成准备工作之后就可以正式开装了。Xcaddy 可以自定义插件编译，这里安装缓存和 Brotli 模块。因为我是阿里云的 DNS，所以再加一个阿里云 DNS 的模块，方便 SSL 证书的签发。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>xcaddy build <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --with github.com/caddyserver/cache-handler <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	--with github.com/ueffel/caddy-brotli <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	--with github.com/caddy-dns/alidns
</span></span></code></pre></div><p>完整的模块列表请看 <a href=https://caddyserver.com/docs/modules/ target=_blank>Modules - Caddy Documentation</a>。</p><p>编译完成后便会在当前目录下产生一个二进制文件。运行</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./caddy
</span></span></code></pre></div><p>即可查看帮助。</p><p>可以使用</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ln -s /caddy的绝对路径/caddy /usr/bin/caddy
</span></span></code></pre></div><p>建立软连接，这样使用 Caddy 时就不用在前面加路径了。但是这样运行的 Caddy 会在/usr/bin 下找 Caddyfile，所以建议加入 <code>--config</code> 指定 Caddyfile 的路径，具体请看后文。</p><div id=caddyfile class=anchor></div><h2 class="relative group">Caddyfile
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#caddyfile aria-label=锚点>#</a></span></h2><p>Caddy 可以使用 json 作为配置文件，但 json 编写较为麻烦，于是他们开发了 Caddyfile 作为配置文件。Caddyfile 的优点很明显，就是易读易写。事实上 Caddyfile 是被转换为之后 json 再被 Caddy 使用的，使用 Caddyfile 就是单纯的为了方面读写。</p><div id=简单上手-caddyfile class=anchor></div><h3 class="relative group">简单上手 Caddyfile
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e7%ae%80%e5%8d%95%e4%b8%8a%e6%89%8b-caddyfile aria-label=锚点>#</a></span></h3><p>Caddy 运行时会自动寻找本身所在目录下的 Caddyfile 并加载。所以我们先在 caddy 二进制文件所在目录下新建一个 Caddyfile (不需要后缀)。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>touch Caddyfile
</span></span></code></pre></div><p>先来看官方给出的结构解析</p><p><figure><img class="my-0 rounded-md" srcset="/posts/%E5%B0%86nginx%E6%9B%B4%E6%8D%A2%E4%B8%BAcaddy/caddyfile_hu5306cdb135854cc08e6409c3bbfe95e8_481786_330x0_resize_q75_box.jpg 330w,
/posts/%E5%B0%86nginx%E6%9B%B4%E6%8D%A2%E4%B8%BAcaddy/caddyfile_hu5306cdb135854cc08e6409c3bbfe95e8_481786_660x0_resize_q75_box.jpg 660w,
/posts/%E5%B0%86nginx%E6%9B%B4%E6%8D%A2%E4%B8%BAcaddy/caddyfile_hu5306cdb135854cc08e6409c3bbfe95e8_481786_1024x0_resize_q75_box.jpg 1024w,
/posts/%E5%B0%86nginx%E6%9B%B4%E6%8D%A2%E4%B8%BAcaddy/caddyfile_hu5306cdb135854cc08e6409c3bbfe95e8_481786_1320x0_resize_q75_box.jpg 2x" src=/posts/%E5%B0%86nginx%E6%9B%B4%E6%8D%A2%E4%B8%BAcaddy/caddyfile_hu5306cdb135854cc08e6409c3bbfe95e8_481786_660x0_resize_q75_box.jpg alt=caddyfile><figcaption>Caddyfile 示例</figcaption></figure></p><p>这里不打算很详细地写 Caddyfile 的所有功能，只打算帮想从 Nginx 换成 Caddyfile 的人快速度过学习阵痛期。如果想详细了解，可以看 <a href=https://mritd.com/2021/06/30/understand-caddyfile-syntax/ target=_blank>Caddyfile 语法浅析 - Kovacs</a>。感谢大佬的解析，让我很快了解了 Caddyfile。</p><p>言归正传，虽然说易读易写，但刚接触还是需要一点时间学习。这里就以 Nginx 的配置文件为例，跟 Caddyfile 一部分一部分对应，会比较直观。</p><p>需要注意的是，<strong>空格在 Caddyfile 中非常重要，所以不要输入无意义的空格</strong>。</p><blockquote><p>The Caddyfile is lexed into tokens before being parsed. Whitespace is significant in the Caddyfile, because tokens are separated by whitespace.</p></blockquote><p>以上是官网原话。</p><p>以下是我的 Nginx 配置中除了默认部分外自行配置的部分。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx.conf data-lang=nginx.conf><span class=line><span class=cl><span class=k> </span> <span class=s> </span> <span class=s>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=kn> </span> <span class=s> </span> <span class=s> </span> <span class=s> </span> <span class=s>listen</span> <span class=s> </span> <span class=s> </span> <span class=s> </span> <span class=mi>443</span> <span class=s>ssl</span> <span class=s>http2</span> <span class=s>default_server</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kn> </span> <span class=s> </span> <span class=s> </span> <span class=s> </span> <span class=s>listen</span> <span class=s> </span> <span class=s> </span> <span class=s> </span> <span class=s>[::]:443</span> <span class=s>ssl</span> <span class=s>http2</span> <span class=s>default_server</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kn> </span> <span class=s> </span> <span class=s> </span> <span class=s> </span> <span class=s>server_name</span> <span class=s> &#39;your</span> <span class=s>ip&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kn> </span> <span class=s> </span> <span class=s> </span> <span class=s> </span> 
</span></span><span class=line><span class=cl><span class=s> </span> <span class=s> </span> <span class=s> </span> <span class=s> </span> <span class=s>ssl_certificate</span> <span class=s>/root/ipssl/ip.pem</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kn> </span> <span class=s> </span> <span class=s> </span> <span class=s> </span> <span class=s>ssl_certificate_key</span> <span class=s>/root/ipssl/ip.key</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kn> </span> <span class=s> </span> <span class=s> </span> <span class=s> </span> <span class=s>ssl_session_timeout</span> <span class=mi>5m</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kn> </span> <span class=s> </span> <span class=s> </span> <span class=s> </span> <span class=s>ssl_protocols</span> <span class=s>TLSv1.1</span> <span class=s>TLSv1.2</span> <span class=s>TLSv1.3</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kn> </span> <span class=s> </span> <span class=s> </span> <span class=s> </span> <span class=s>return</span> <span class=mi>444</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kn> </span> <span class=s> </span> <span class=err>}</span> <span class=c1># 防止证书泄露源站IP
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=s> </span> <span class=s> </span> <span class=s>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=kn> </span> <span class=s> </span> <span class=s> </span> <span class=s> </span> <span class=s>listen</span> <span class=s> </span> <span class=s> </span> <span class=s> </span> <span class=mi>80</span> <span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kn> </span> <span class=s> </span> <span class=s> </span> <span class=s> </span> <span class=s>listen</span> <span class=s> </span> <span class=s> </span> <span class=s> </span> <span class=s>[::]:80</span> <span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kn> </span> <span class=s> </span> <span class=s> </span> <span class=s> </span> <span class=s>server_name</span> <span class=s> &#39;your</span> <span class=s>ip&#39;</span> <span class=s>myvessel.top</span> <span class=s>*.myvessel.top</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kn> </span> <span class=s> </span> <span class=s> </span> <span class=s> </span> <span class=s>rewrite</span> <span class=s>^(.*)</span>$ <span class=s>https://</span><span class=nv>$host$1</span> <span class=s>permanent</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kn> </span> <span class=s> </span> <span class=err>}</span> <span class=c1># 将所有http请求重定向为https请求
</span></span></span></code></pre></div><p>关于防止证书泄露源站 IP，具体请看<a href=https://b.myvessel.top/posts//%e4%bb%8e%e9%9b%b6%e5%bc%80%e5%a7%8b%e7%9a%84%e5%bb%ba%e7%ab%99%e8%ae%b0#%e9%98%b2%e6%ad%a2%e8%af%81%e4%b9%a6%e6%b3%84%e9%9c%b2%e6%ba%90%e7%ab%99-ip target=_blank>
从零开始的建站记#防止证书泄露源站IP</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx.conf data-lang=nginx.conf><span class=line><span class=cl><span class=k>upstream</span> <span class=s>halo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=kn> </span> <span class=s> </span> <span class=s>server</span> <span class=n>127.0.0.1</span><span class=p>:</span><span class=mi>8090</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=c1># 设置上游，可用于负载均衡，不过我没弄。可以给下方server块当作proxy主机使用
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=kn> </span> <span class=s> </span> <span class=s>listen</span> <span class=mi>443</span> <span class=s>ssl</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kn> </span> <span class=s> </span> <span class=s>listen</span> <span class=s>[::]:443</span> <span class=s>ssl</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kn> </span> <span class=s> </span> <span class=s>server_name</span> <span class=s>myvessel.top</span> <span class=s>www.myvessel.top</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kn> </span> <span class=s> </span> 
</span></span><span class=line><span class=cl><span class=s> </span> <span class=s> </span> <span class=s>ssl_certificate</span> <span class=s>/etc/letsencrypt/live/myvessel.top/fullchain.pem</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kn> </span> <span class=s> </span> <span class=s>ssl_certificate_key</span> <span class=s>/etc/letsencrypt/live/myvessel.top/privkey.pem</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kn> </span> <span class=s> </span> <span class=s>ssl_session_timeout</span> <span class=mi>5m</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kn> </span> <span class=s> </span> <span class=s>ssl_protocols</span> <span class=s>TLSv1.1</span> <span class=s>TLSv1.2</span> <span class=s>TLSv1.3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn> </span> <span class=s> </span> <span class=s>location</span> <span class=s>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=kn> </span> <span class=s> </span> <span class=s> </span> <span class=s> </span> <span class=s>proxy_pass</span> <span class=s>http://halo</span><span class=p>;</span> <span class=c1># 使用上游halo
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn> </span> <span class=s> </span> <span class=s> </span> <span class=s> </span> <span class=s>proxy_set_header</span> <span class=s>HOST</span> <span class=nv>$host</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kn> </span> <span class=s> </span> <span class=s> </span> <span class=s> </span> <span class=s>proxy_set_header</span> <span class=s>X-Forwarded-Proto</span> <span class=nv>$scheme</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kn> </span> <span class=s> </span> <span class=s> </span> <span class=s> </span> <span class=s>proxy_set_header</span> <span class=s>X-Real-IP</span> <span class=nv>$remote_addr</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kn> </span> <span class=s> </span> <span class=s> </span> <span class=s> </span> <span class=s>proxy_set_header</span> <span class=s>X-Forwarded-For</span> <span class=nv>$proxy_add_x_forwarded_for</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kn> </span> <span class=s> </span> <span class=s> </span> <span class=s> </span> <span class=s>client_max_body_size</span> <span class=mi>1024m</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kn> </span> <span class=s> </span> <span class=err>}</span>
</span></span><span class=line><span class=cl><span class=err>}</span> <span class=c1># 反向代理至halo，也就是本博客
</span></span></span></code></pre></div><p>以下是对应的 Caddyfile (使用效果并非完全一样，只是基本一致)。需要注意的是上面 Nginx 的配置是自己配置的部分，而下面的 Caddyfile 是完整的文件内容。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Caddyfile data-lang=Caddyfile><span class=line><span class=cl><span class=gh>www.myvessel.top</span>, <span class=gh>myvessel.top</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>encode</span> <span class=s>gzip</span><span class=c1> # 因为nginx默认开启了gzip，所以这里也跟着一起开。
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>reverse_proxy</span> <span class=n>127.0.0.1</span><span class=p>:</span><span class=mi>8090</span><span class=c1> # 反向代理至8090端口
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p>没错，就这么点。好了，本文圆满结束😋</p><p>开玩笑捏。不过上面的 Caddyfile 范例是真的可以直接投入使用的。也可以跟我一起做一些别的配置。让使用更顺心一点。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Caddyfile data-lang=Caddyfile><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>storage</span> <span class=s>file_system</span> <span class=nd>/root/caddy/</span><span class=c1>
</span></span></span><span class=line><span class=cl><span class=c1>	# 让运行相关的文件保存至/root/caddy下，路径可随意自定义
</span></span></span><span class=line><span class=cl><span class=c1></span>	
</span></span><span class=line><span class=cl>	<span class=k>log</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>output</span> <span class=s>file</span> <span class=s>/root/caddy/logs/access.log</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>roll_uncompressed</span><span class=c1> # 日志文件不启用gzip压缩
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=c1> # 自定义路径保存日志
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>	<span class=k>acme_dns</span> <span class=s>alidns</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>access_key_id</span> <span class=s>your_key</span>
</span></span><span class=line><span class=cl>		<span class=k>access_key_secret</span> <span class=s>your_secret</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=c1> # 阿里云DNS认证配置
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=c1> # 第一个没有前缀的大括号内容即为全局配置，跟Nginx的全局配置类似
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=gh>www.myvessel.top</span>, <span class=gh>myvessel.top</span> <span class=p>{</span><span class=c1> # 注释1
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>encode</span> <span class=s>gzip</span> <span class=s>br</span><span class=c1> # 装了Brotli所以启用
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>reverse_proxy</span> <span class=n>127.0.0.1</span><span class=p>:</span><span class=mi>8090</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=c1> # 大括号有地址前缀的即为站点配置，跟Nginx的server块类似。虽然只有单个站点的情况下可以不加大括号，但我还是建议全都加上大括号以防万一。
</span></span></span></code></pre></div><p>注释 1：此行大括号的前缀即为地址 (address)，可以理解为 Nginx 中 server 块中的 <code>server_name</code>。</p><p>什么？你问 SSL 证书相关配置去哪了？http 重写到 https 又去哪了？防止证书泄露源站 ip 的配置呢？</p><p>答案是不需要了，Caddy 已经默认帮你配置好了。默认全站 https (即自带 http 重写到 https，并自动申请证书，自动配置证书)，在<a href=https://myvessel.top/posts/%e5%b0%86nginx%e6%9b%b4%e6%8d%a2%e4%b8%bacaddy/#%e7%ae%80%e5%8d%95%e4%b8%8a%e6%89%8b-caddyfile target=_blank>
从零开始的建站记#防止证书泄露源站IP</a> 中有提到 Nginx 1.19.4 以上给出了 <code>ssl_reject_handshake</code> 这个选项，Caddy 相当于默认启用了 <code>ssl_reject_handshake</code>，避免了因为证书泄露源站 IP。如果有需要当然可以对着官方文档自己动手调整相关配置。但如果没有精力做这些，直接开箱即用即可，非常舒畅简便。</p><p>如果需要数字 IP 访问，并进行了对应的站点配置。根据官方文档<a href=https://caddyserver.com/docs/v2-upgrade#https-and-ports target=_blank>
此处</a>的说明，IP 的 SSL 证书将从本地信任的嵌入式 CA 颁发证书。</p><p>关于“转发”效果的功能，实例只提到了 <code>reverse_proxy</code>，实际上一共有以下几种：</p><ul><li><code>reverse_proxy</code>：即反向代理，与 Nginx 中 server 块中的 <code>location / {}</code> 类似。</li><li><code>root</code>：与 Nginx 中 server 块中的 <code>root</code> 类似。可以换一行加上 <code>file_server</code> 表示提供静态文件服务器，加上 <code>php_fastcgi [以及后续参数]</code> 提供 PHP 服务。
后两种是对访问 URI 进行操作。</li><li><code>redir</code>：将请求 URI 重定向至某个 URI。</li><li><code>rewrite</code>：将请求 URI 重写至某个 URI。与 <code>redi</code> 的不同之处在于使用 <code>rewrite</code> 时请求客户端显示的 URI 不变，重写是在内部进行的。而 <code>redi</code> 会让客户端的 URI 一起变化。</li></ul><p>也就是说，Caddy 的自动 https 重写，实际上是用 redir 完成的，相当于在每个站点配置中加入了如下字段：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Caddyfile data-lang=Caddyfile><span class=line><span class=cl>	<span class=gh>@http</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>Protocol</span> <span class=s>http</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=gh>redir</span> <span class=gh>@http</span> <span class=gh>https://</span><span class=se>{host}{uri}</span><span class=p>
</span></span></span></code></pre></div><p>其中@开头前缀的大括号作用是定义匹配器，可以实现复杂的匹配功能，以供调用。</p><p>若是想开启 http 3，可在全局配置 (即第一个没有前缀的大括号)中加入如下字段：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Caddyfile data-lang=Caddyfile><span class=line><span class=cl><span class=gh>servers</span> <span class=gh>:</span> <span class=gh>443</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>protocols</span> <span class=s>h1</span> <span class=s>h2</span> <span class=s>h3</span><span class=c1> #也可以只写 h3，表示只允许 http3 连接，不过兼容性差
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p>即可开启 http 3。</p><div id=测试格式化-caddyfile class=anchor></div><h3 class="relative group">测试，格式化 Caddyfile
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e6%b5%8b%e8%af%95%e6%a0%bc%e5%bc%8f%e5%8c%96-caddyfile aria-label=锚点>#</a></span></h3><p>写好了 Caddyfile，自然不能直接启用，要先测试一下有没有问题。官方给出了如下命令用来测试：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>caddy validate
</span></span></code></pre></div><p>效果对应 Nginx 的<code>nginx -t</code>。<del>感觉&mldr; 不如<code>nginx -t</code>&mldr; 简洁</del>默认在 caddy 二进制文件所在目录下寻找 Caddyfile，若 Caddyfile 在别处可在命令后加入<code>--config /Caddyfile 的路径</code>。</p><p>事实上，自己编写的 Caddyfile 可能会有很多不规范的格式。若有强迫症，可在测试通过后使用官方给出的</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>caddy fmt --overwrite
</span></span></code></pre></div><p>来对 Caddyfile 内容进行格式化。</p><p>同样是默认在 caddy 二进制文件所在目录下寻找 Caddyfile，若 Caddyfile 在别处可直接在命令末尾空一格再加上 Caddyfile 的路径。</p><div id=启动-caddy class=anchor></div><h2 class="relative group">启动 Caddy
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%90%af%e5%8a%a8-caddy aria-label=锚点>#</a></span></h2><p>就算比起 Nginx 友好得多，过程对新手也还是有点难的。不过现在终于完事了，可以投入使用了。Caddy 有两种启动方法，分别是<code>caddy run</code>和<code>caddy start</code>。区别在于<code>caddy run</code>会在前台启动 Caddy，官方说 Ctrl+C 或者退出终端会结束 Caddy 进程 (但根据我亲身体验，完全放屁，只有<code>kill -9</code>才能彻底停止，否则会一直占用端口)。而<code>caddy start</code>会在后台启动，你可以关闭终端去做任何事。可以使用<code>caddy stop</code>来停止进程。所以正常投入使用时，应该选择<code>caddy start</code>而不是<code>caddy run</code>。</p><p>启动后，一开始是访问不了的，因为 Caddy 还在申请证书。等一会就可以访问了。日志中可以看到</p><pre tabindex=0><code class=language-log data-lang=log>tls.obtain certificate obtained successfully
</code></pre><p>的字样，说明证书申请成功了。</p><p>根据官方文档<a href=https://caddyserver.com/docs/v2-upgrade#https-and-ports target=_blank>
此处</a>和<a href=https://caddyserver.com/docs/caddyfile/options#acme-ca target=_blank>
此处</a>的说明，若不进行特别配置，证书默认由 Let&rsquo;s Encrypt 或 ZeroSSL 颁发。我这边是随机到 Let&rsquo;s Encrypt 的证书。</p><p>在运行过程中，可以使用<code>caddy reload</code>来重载配置文件，与 Nginx 中<code>nginx -s reload</code>类似。</p><div id=保护-caddy-进程 class=anchor></div><h2 class="relative group">保护 Caddy 进程
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e4%bf%9d%e6%8a%a4-caddy-%e8%bf%9b%e7%a8%8b aria-label=锚点>#</a></span></h2><p>其实本来直接<code>caddy start</code>就挺方便的，进程也挺稳定。但有人喜欢用 systemd 来管理。官方也给出了<a href=https://caddyserver.com/docs/running#manual-installation target=_blank>
教程</a>。简单总结一下流程。</p><p>首先确认 caddy 文件位于/usr/bin/下，或使用上文提到的软连接。然后添加用户组和用户：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>groupadd --system caddy
</span></span><span class=line><span class=cl>useradd --system <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	--gid caddy <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	--create-home <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	--home-dir /var/lib/caddy <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	--shell /usr/sbin/nologin <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	--comment <span class=s2>&#34;Caddy web server&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	caddy
</span></span></code></pre></div><p>然后在/etc/systemd/system/下新建<code>caddy.service</code>，在里面写入如下内容：</p><pre tabindex=0><code class=language-caddy. data-lang=caddy.>[Unit]
Description=Caddy
Documentation= https://caddyserver.com/docs/
After=network. Target network-online. Target
Requires=network-online. Target

[Service]
Type=notify
User=caddy
Group=caddy
ExecStart=/usr/bin/caddy run --environ --config /etc/caddy/Caddyfile
ExecReload=/usr/bin/caddy reload --config /etc/caddy/Caddyfile --force
TimeoutStopSec=5 s
LimitNOFILE=1048576
LimitNPROC=512
PrivateTmp=true
ProtectSystem=full
AmbientCapabilities=CAP_NET_BIND_SERVICE

[Install]
WantedBy=multi-user. Target
</code></pre><p>请仔细检查<code>execStart</code>和<code>execReload</code>中的路径是否符合自己实际情况，然后保存退出。</p><p>然后</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Systemctl daemon-reload
</span></span><span class=line><span class=cl>Systemctl <span class=nb>enable</span> --now caddy
</span></span><span class=line><span class=cl>Systemctl status caddy
</span></span></code></pre></div><p>若为<code>active</code>，则运行成功。</p><p><del>但我自己运行失败，查了一下可能是 selinux 的问题，但我压根没有 selinux。一气之下直接不弄了，继续<code>caddy start</code></del>。</p><div id=后记 class=anchor></div><h2 class="relative group">后记
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%90%8e%e8%ae%b0 aria-label=锚点>#</a></span></h2><p>Caddy 比起 Nginx + Certbot 简单了不止一点，属于是新手福音了。当初要是先看到 Caddy，建站时间肯定能省好几天。不过 Nginx + Certbot 也让我学到了不少东西就是了。提前上课，避免补课。如果你还在为 Nginx 的配置和 SSL 证书烦恼，不妨也来试试 Caddy。</p><div id=参考文章 class=anchor></div><h2 class="relative group">参考文章
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%8f%82%e8%80%83%e6%96%87%e7%ab%a0 aria-label=锚点>#</a></span></h2><p>除了提及的各官方文档外，感谢以下文章的作者：</p><p><a href=https://u.sb/xcaddy/ target=_blank>Debian 11 / Ubuntu 22.04 使用 xcaddy 自定义编译 Caddy - 烧饼博客</a></p><p><a href=https://mritd.com/2021/06/30/understand-caddyfile-syntax/ target=_blank>Caddyfile 语法浅析 - Kovacs (mritd.com)</a></p><p><a href=https://mritd.com/2021/08/20/switching-rrom-nginx-too-caddy/ target=_blank>从 Nginx 切换到 Caddy - Kovacs (mritd.com)</a></p></div></div><script>var oid="views_posts/将Nginx更换为Caddy/index.md",oid_likes="likes_posts/将Nginx更换为Caddy/index.md"</script><script type=text/javascript src=/js/page.min.0e49973b4ad0a382c7c6012d8bff8226316642daabc4f8a20477bd08674f3da6e2fa993bc20ad4f51e7c5bb68e6f913a207a7c4fe37ea0e7b806894afce0a64e.js integrity="sha512-DkmXO0rQo4LHxgEti/+CJjFmQtqrxPiiBHe9CGdPPabi+pk7wgrU9R58W7aOb5E6IHp8T+N+oOe4BolK/OCmTg=="></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/posts/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E5%BB%BA%E7%AB%99%E8%AE%B0/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">从零开始的建站记</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2023-04-03 14:24:07 +0800 +0800">2023年 4月 3日</time></span></span></a></span>
<span><a class="flex text-right group ml-3" href=/posts/%E6%90%AD%E5%BB%BAmatrix%E7%9A%84%E6%9C%8D%E5%8A%A1%E7%AB%AFsynapse/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">搭建Matrix的服务端Synapse</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2023-04-28 14:37:56 +0800 +0800">2023年 4月 28日</time></span></span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer></article><div id=top-scroller class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label title>&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2023
Vessel</p><p class="text-xs text-neutral-500 dark:text-neutral-400">由 <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a> 强力驱动</p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.35c1113bcc16c5a59bf031082f9e63822aa95280423881a7847a7ff33a16e6299ce6a840d9ef4e10d947e030a18f3f20359afb2ec0f35967484b9a9360ac3145.js integrity="sha512-NcERO8wWxaWb8DEIL55jgiqpUoBCOIGnhHp/8zoW5imc5qhA2e9OENlH4DChjz8gNZr7LsDzWWdIS5qTYKwxRQ=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://b.myvessel.top/ style=z-index:500><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title>
<span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>